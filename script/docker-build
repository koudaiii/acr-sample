#!/bin/bash
set -e

# Load environment variables if .env file exists
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

# Default values
ACR_REGISTRY=${ACR_REGISTRY:-acrsamplekoudaiii.azurecr.io}
IMAGE_NAME=${IMAGE_NAME:-acrsample}
IMAGE_TAG=${IMAGE_TAG:-$(git rev-parse HEAD)}

echo "Building Docker image..."
echo "Registry: ${ACR_REGISTRY}"
echo "Image: ${IMAGE_NAME}"
echo "Tag: ${IMAGE_TAG}"

docker build -t ${ACR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} .
docker tag ${ACR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} ${ACR_REGISTRY}/${IMAGE_NAME}:latest

echo "Docker image built successfully!"
echo "Tagged as: ${ACR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"
echo "Tagged as: ${ACR_REGISTRY}/${IMAGE_NAME}:latest"
